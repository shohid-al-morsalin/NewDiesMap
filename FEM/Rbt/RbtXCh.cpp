/* Generated by Together */

#include "stdafx.h"
#include "RbtXCh.h"
#include "..\..\SYS\Var.h"
#include "..\..\SERIAL\MsgItem.h"
#include "..\..\SERIAL\BEME95.h"
#include "..\..\Sys\Var.h"
#include "..\..\IPC\SMHdr.h"
#include "..\..\IPC\SMCHdr.h"


CRbtXCh::CRbtXCh()
{
}

CRbtXCh::~CRbtXCh()
{
}

short CRbtXCh::Xfer( char * text )
{
	if (pBemE95) {
		CMsgItem *pMsg = new CMsgItem;
		if (pMsg) {
			pMsg->SetAlloc(text,strlen(text));
			if (Var.Model == CSMOL::FSM900DUAL) {
				pMsg->MsgSrc = CMsgItem::MSB900;
			}
			if (Var.Model == CSMOL::FSM128DUAL) {
				pMsg->MsgSrc = CMsgItem::MSB128;
			}
			pMsg->DataTyp = CMsgItem::DATATYPE::ROBOTCMD;
			pBemE95->Send( pMsg );
			delete pMsg;
		}
	}
	return TRUE;
}

short CRbtXCh::Connect(short Port)
{
	ComPort = Port;
	if (RbtStatus.GetState() != CRbtStatus::DOWNED) {
		LastError.Format("Connected to port %d",Port);
		return 1;
	}
	LastError.Format("Not connected to port %d, Robot downed or disabled",Port);
	return -1;
}
short CRbtXCh::Disconnect()
{
	if (RbtStatus.GetState() != CRbtStatus::NOTCOMMUNICATING) {
		RbtStatus.Set(CRbtStatus::NOTCOMMUNICATING);
		LastError.Format("Disconnected from port %d",ComPort);
		return 1;
	}
	return 0;
}
short CRbtXCh::HomeAll()
{
	if (RbtStatus.IsIdle()) {
		LastError = "HomeAll OK";
		return 1;
	}
	LastError = "Robot busy";
	return 0;
}
short CRbtXCh::InitAligner()
{
	if (RbtStatus.IsIdle()) {
		LastError = "InitAligner OK";
		return 1;
	}
	LastError = "Robot busy";
	return 0;
}
